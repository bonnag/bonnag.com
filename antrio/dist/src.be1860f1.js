parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"IzeE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class t{constructor(){this.numCols=42,this.numRows=20,this.isLoaded=!1,this.roomName="",this.roomNumber="",this._tileCodeRows=null,this._version=0,this._getRequestInFlight=!1,this._targetRoomNumber="",this._unsavedEdits=[],this._inFlightEdits=[],window.setInterval(this._handleAmbientTick.bind(this),1e3)}_handleAmbientTick(){if(this._unsavedEdits.length>0&&0===this._inFlightEdits.length){let t=new XMLHttpRequest;t.open("PUT","https://antr.io/rooms/"+this.roomNumber);let e=this._buildEditRequest();this._inFlightEdits=this._unsavedEdits,this._unsavedEdits=[],t.setRequestHeader("Content-Type","application/json");let s=this;return t.onload=function(){204===t.status?(s._inFlightEdits=[],s._version++):(s._unsavedEdits=s._inFlightEdits.concat(s._unsavedEdits),s._inFlightEdits=[])},void t.send(JSON.stringify(e))}if(this._targetRoomNumber!==this.roomNumber&&!this._getRequestInFlight&&this.isSaved()){this.isLoaded=!1,this.roomName="Loading ...";let t=new XMLHttpRequest;t.open("GET","https://antr.io/rooms/"+this._targetRoomNumber),t.setRequestHeader("Content-Type","application/json");let e=this;return t.onload=function(){if(200===t.status){let s=JSON.parse(t.responseText);e._handleRoomResponse(s)}e._getRequestInFlight=!1},this._getRequestInFlight=!0,void t.send()}}_handleRoomResponse(t){this.roomName=t.name,this.roomNumber=t.number,this._tileCodeRows=t.tileCodeRows,this._version=t.version,this.isLoaded=!0}isSaved(){return 0===this._unsavedEdits.length&&0===this._inFlightEdits.length}changeRoom(t){let e=""+t;this._targetRoomNumber=e,this.isLoaded=!1,this.roomName="Loading ..."}getTileCode(t,e){if(!this.isLoaded)throw new Error("cannot get tiles for room that has not loaded");return this._tileCodeRows[t][e]}editTileCode(t,e,s){if(!this.isLoaded)throw new Error("cannot edit room that has not loaded");this._tileCodeRows[t]=this._replaceCharInStr(this._tileCodeRows[t],e,s),this._unsavedEdits.push({x:e,y:t,tileCode:s})}_buildEditRequest(){return{number:this.roomNumber,existingVersion:this._version,tileEdits:this._unsavedEdits.slice(),optionalNewName:null}}_replaceCharInStr(t,e,s){return t.substr(0,e)+s+t.substr(e+s.length)}}exports.default=t;
},{}],"Aw3A":[function(require,module,exports) {
const e="Z",r=["Z","N","NE","E","SE","S","SW","W","NW"];function n(e,r){return e===r}function t(e){switch(e){case"N":case"NE":case"E":case"SE":case"S":case"SW":case"W":case"NW":case"Z":return e;default:throw new Error("unsupported direction "+e)}}function c(e){return e}function u(e){return"Z"===e}function a(e){return"N"===e||"S"===e}function o(e){return"E"===e||"W"===e}function s(e){return"NE"===e||"SE"===e||"SW"===e||"NW"===e}function i(e){switch(e){case"N":return 0;case"NE":return 1;case"E":return 2;case"SE":return 3;case"S":return 4;case"SW":return 5;case"W":return 6;case"NW":return 7;default:throw new Error("unsupported direction "+e)}}function f(e){if(e<-8||e>15)throw new Error("out of range");switch(e<0?e+=8:e>=8&&(e-=8),e){case 0:return"N";case 1:return"NE";case 2:return"E";case 3:return"SE";case 4:return"S";case 5:return"SW";case 6:return"W";case 7:return"NW";default:throw new Error("unsupported ordinal "+e)}}function E(e){return(i(e)-2)/8*Math.PI*2}function d(e,r,n,t){return!e||r||n||t?e||!r||n||t?e||r||!n||t?e&&!r&&n&&!t?"NW":!e&&r&&n&&!t?"NE":e||r||n||!t?e&&!r&&!n&&t?"SW":!e&&r&&!n&&t?"SE":"Z":"S":"N":"E":"W"}function w(e,r){if(e===r)return!0;if(u(e)||u(r))return!1;const n=i(e),t=i(r);return(n+1)%8==t||(t+1)%8==n}function h(r,n){return w(r,n)?{effect:1,dir:n}:w(l(r),n)?{effect:-1,dir:l(n)}:{effect:0,dir:e}}function l(e){return N(e,4)}function N(e,r){if(r<-8||r>8)throw new Error("out of range");return u(e)?e:f(i(e)+r)}function S(e){return u(e)?[e]:[e,N(e,-1),N(e,1)]}function W(e,r){return Math.max(Math.abs(e[0]-r[0]),Math.abs(e[1]-r[1]))}function b(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function p(e,n){const t=W(e,n);let c=void 0,u=void 0;for(let a of r){let r=W(M(e,a,t),n);(!u||r<c)&&(c=r,u=a)}return u}function M(e,r,n){switch(r){case"Z":return[e[0],e[1]];case"N":return[e[0],e[1]+n];case"NE":return[e[0]+n,e[1]+n];case"E":return[e[0]+n,e[1]];case"SE":return[e[0]+n,e[1]-n];case"S":return[e[0],e[1]-n];case"SW":return[e[0]-n,e[1]-n];case"W":return[e[0]-n,e[1]];case"NW":return[e[0]-n,e[1]+n];default:throw new Error("unsupported direction "+r)}}function Z(e,r,n){return M(e,r,s(r)?n*Math.sqrt(2)*.5:n)}function k(e,r,n,t){if(t<0)throw new Error("tolerance out of range");return W(n,C(e,r,n))<t}function v(e,r){return[e[0]+r[0],e[1]+r[1]]}function g(e,r){return[e[0]-r[0],e[1]-r[1]]}function m(e,r){return[e[0]*r,e[1]*r]}function C(e,r,n){const t=g(n,e);let c=void 0;switch(r){case"Z":c=[0,0];break;case"N":case"S":c=[0,t[1]];break;case"E":case"W":c=[t[0],0];break;case"NE":case"SW":{const e=.5*(t[0]+t[1]);c=[e,e];break}case"NW":case"SE":{const e=.5*(t[0]-t[1]);c=[e,-e];break}default:throw new Error("bad direction "+r)}return v(c,e)}module.exports={None:e,All:r,areEqual:n,fromCardinal:t,fromArrows:d,toCardinal:c,toRadians:E,isNone:u,isVertical:a,isHorizontal:o,isDiagonal:s,actsOn:h,reverse:l,rotateClockwise:N,andEitherSide:S,translateChebyshev:M,translateEuclidean:Z,chebyshevDistanceBetween:W,euclideanDistanceBetween:b,bestDirBetween:p,snapToLine:C,isOnLine:k,addVec:v,subVec:g,scaleVec:m};
},{}],"v7Zp":[function(require,module,exports) {
const t=require("./directions");class e{constructor(e){this._history=[];this._segmentDistance=8,this._historyDistanceNeeded=6*this._segmentDistance,this._epsilon=1e-8;let s=e,i=t.reverse(e.dir);for(let h=0;h<this._historyDistanceNeeded;h+=1)this._history.unshift([1,s]),s={pos:t.translateChebyshev(s.pos,i,1),dir:e.dir,normal:e.normal}}reportCurrentHeadPose(e){const s=this._history[this._history.length-1][1],i=t.chebyshevDistanceBetween(s.pos,e.pos);i<this._epsilon||this._history.push([i,e])}getSegmentPoses(t){const e=[];let s=0,i=void 0;for(let h=this._history.length-1;h>=0&&e.length!==t;h--){let t=this._history[h],o=this._segmentDistance*(1+e.length),r=s,n=i,l=t[0];i=t[1],s+=l,r<=o&&s>=o&&e.push(this._interpolatePose(n,i,r,s,o))}for(;e.length<t;){const t=i;e.push(t)}return e}_interpolatePose(t,e,s,i,h){return t}}module.exports=e;
},{"./directions":"Aw3A"}],"+bA/":[function(require,module,exports) {
function e(e,r){return n(e)||i(e,r)||t()}function t(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function i(e,t){var i=[],n=!0,r=!1,o=void 0;try{for(var l,s=e[Symbol.iterator]();!(n=(l=s.next()).done)&&(i.push(l.value),!t||i.length!==t);n=!0);}catch(a){r=!0,o=a}finally{try{n||null==s.return||s.return()}finally{if(r)throw o}}return i}function n(e){if(Array.isArray(e))return e}const r=require("./directions"),o=1e-8;function l(e,t){const i=e.tileSize,n=[Math.floor(t[0]/i),Math.floor(t[1]/i)];return[n,[t[0]-n[0]*i,t[1]-n[1]*i],r.scaleVec(n,i)]}function s(e,t,i,n,o){const l=c(e,t,i,n,o),s=r.translateChebyshev(e.pos,n,o);let a=void 0,u=void 0;for(let c of l.concat([e])){let e=r.chebyshevDistanceBetween(c.pos,s);(!u||e<a)&&(a=e,u=c)}return u}function a(e,t){const i=e.tileSize,n=e.minDist,o=i-n;let l=[];return"v"===t?l=[{tileRelativeLinePos:[0,o],startToEndDir:r.fromCardinal("E")}]:"q"===t?l=[{tileRelativeLinePos:[o,i],startToEndDir:r.fromCardinal("S")}]:"m"===t?l=[{tileRelativeLinePos:[i,n],startToEndDir:r.fromCardinal("W")}]:"p"===t?l=[{tileRelativeLinePos:[n,0],startToEndDir:r.fromCardinal("N")}]:"w"===t?l=[{tileRelativeLinePos:[0,0],startToEndDir:r.fromCardinal("NE")}]:"u"===t?l=[{tileRelativeLinePos:[0,i],startToEndDir:r.fromCardinal("SE")}]:"l"===t?l=[{tileRelativeLinePos:[i,i],startToEndDir:r.fromCardinal("SW")}]:"n"===t&&(l=[{tileRelativeLinePos:[i,0],startToEndDir:r.fromCardinal("NW")}]),l}function c(t,i,n,r,o){const s=e(l(i,t.pos),3);return u(t,i,n,s[0],s[1],s[2],r,o,0)}function u(e,t,i,n,l,s,c,d,D){if(d<-o)throw new Error("motionDistance cannot be negative");if(d<t.minDist)return[];if(r.isNone(c))return[];const E=a(t,i.tileCodeAt(n));if(E.length<1)return[];if(E.length>1)throw new Error("multiple paths in one tile not supported");const p=E[0],y=2*t.minDist+o,C=m(t,p,l,0==D?o:y);if(!C)return[];const P=r.chebyshevDistanceBetween(l,C);if(P>d)return[];let T=d-P;const b=[],w=r.andEitherSide(c);for(let a of w){let l=v(t,p,C,a,T);l||(l={tileRelativePos:C,dir:e.dir,normal:r.rotateClockwise(p.startToEndDir,-2)});let d=T-r.chebyshevDistanceBetween(C,l.tileRelativePos);if(d<t.minDist+o){b.push(f(l,s));continue}let m=!1;if(0==D)for(let r of h(t,n,l.tileRelativePos)){let n=u(e,t,i,r.tileCoords,r.dubiousTileRelativePos,r.tileOriginPos,c,d,D+1);n.length>0&&(m=!0,b.push(...n))}m||b.push(f(l,s))}return b}function f(e,t){return{pos:d(t,e.tileRelativePos),dir:e.dir,normal:e.normal}}function d(e,t){return[e[0]+t[0],e[1]+t[1]]}function v(e,t,i,n,l){if(l<-o)throw new Error("motionDistance cannot be negative");if(l<e.minDist)return;if(r.isNone(n))return;const s=r.actsOn(n,t.startToEndDir);if(0==s.effect)return;const a=r.translateChebyshev(i,s.dir,l),c=D(e,a);return{tileRelativePos:r.translateChebyshev(a,s.dir,-c),dir:s.dir,normal:r.rotateClockwise(t.startToEndDir,-2)}}function*h(e,t,i){for(let n of r.All){if(r.isNone(n))continue;let o=r.translateChebyshev([0,0],n,1),l=r.translateChebyshev([0,0],n,-e.tileSize),s=r.addVec(t,o),a=r.addVec(i,l);yield{tileCoords:s,dubiousTileRelativePos:a,tileOriginPos:r.scaleVec(s,e.tileSize)}}}function m(e,t,i,n){const o=r.snapToLine(t.tileRelativeLinePos,t.startToEndDir,i),l=D(e,o),s=[.5*e.tileSize,.5*e.tileSize],a=r.bestDirBetween(o,s),c=r.translateChebyshev(o,a,l),u=r.snapToLine(t.tileRelativeLinePos,t.startToEndDir,c);return r.chebyshevDistanceBetween(i,u)<n?u:void 0}function D(e,t){return Math.max(E(e,t[0]),E(e,t[1]))}function E(e,t){const i=e.tileSize-e.minDist;return t<0?0-t:t>i?t-i:0}module.exports={quantize:l,move:s,computeMoves:c};
},{"./directions":"Aw3A"}],"H99C":[function(require,module,exports) {
"use strict";var t=e(require("./room-store.js"));function e(t){return t&&t.__esModule?t:{default:t}}const i=require("./segment-train.js"),s=require("./tile-paths2"),n=require("./directions"),o=new t.default;let r=!1;const a=28,h=28,u=16,d={tileSize:u,minDist:.01};let c={pos:[160,96-d.minDist],dir:n.fromCardinal("E"),normal:n.fromCardinal("N")},l=0;const f=new i(c),v=1,p=2.5,g={tileCodeAt:function(t){const e=t[0],i=o.numRows-t[1]-1;return o.getTileCode(i,e)}};let m=void 0,w=void 0,P=void 0,y=void 0,x=void 0,C=void 0,k=void 0;const E={},D={k37:"left",k39:"right",k38:"up",k40:"down"},L={" ":1,".":2,l:9,m:5,n:10,q:4,p:6,u:8,v:3,w:7};function R(){o.changeRoom(5050),window.addEventListener("keydown",function(t){T.keys=T.keys||[];var e=["k"+t.keyCode],i=D[e];i&&(E[i]=!0,t.preventDefault())}),window.addEventListener("keyup",function(t){if(69===t.keyCode)return r=!r,void t.preventDefault();var e=D["k"+t.keyCode];e&&(E[e]=!1,t.preventDefault())}),m=new q(0,0,16,16,"sprite","","",0,16,2),w=new q(0,0,16,16,"sprite","","",0,8,2),P=new q(16,14,0,0,"text","black",""),y=new q(60,240,42,42,"sprite","","",52,0,2),x=new q(25,275,42,44,"sprite","","",10,0,2),C=new q(95,275,42,44,"sprite","","",31,0,2),k=new q(60,310,42,42,"sprite","","",74,0,2),T.start()}const T={canvas:document.createElement("canvas"),touchPositions:[],mousePosition:null,start:function(){this.canvas.width=o.numCols*u,this.canvas.height=a+o.numRows*u+28,this.context=this.canvas.getContext("2d"),document.body.insertBefore(this.canvas,document.getElementById("gameAreaHolder")),this.frameNo=0,this.interval=setInterval(M,30);let t=this;this.canvas.addEventListener("mousedown",function(e){t.touchPositions=[t.getPointerPos(e)],e.preventDefault()},!1),this.canvas.addEventListener("mouseup",function(e){t.touchPositions=[],e.preventDefault()},!1),this.canvas.addEventListener("mousemove",function(e){var i=t.getPointerPos(e);t.mousePosition=i,e.buttons>0&&(t.touchPositions=[i]),e.preventDefault()},!1),this.canvas.addEventListener("touchstart",function(e){t.touchPositions=[];for(var i=0;i<e.targetTouches.length;i++)t.touchPositions.push(t.getPointerPos(e.targetTouches[i]));e.preventDefault()},!1),this.canvas.addEventListener("touchend",function(e){t.touchPositions=[];for(var i=0;i<e.targetTouches.length;i++)t.touchPositions.push(t.getPointerPos(e.targetTouches[i]));e.preventDefault()},!1),this.canvas.addEventListener("touchmove",function(e){t.touchPositions=[];for(var i=0;i<e.targetTouches.length;i++)t.touchPositions.push(t.getPointerPos(e.targetTouches[i]));e.preventDefault()},!1)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},stop:function(){clearInterval(this.interval)},getPointerPos:function(t){const e=this.canvas.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}};function q(t,e,i,s,n,o,r,a,h,u){this.body=null,this.x=t,this.y=e,this.angle=0,this.flip=!1,this.width=i,this.height=s,this.type=n,this.text=r,this.color=o,this.spriteX=a,this.spriteY=h,this.update=function(){const t=T.context;if("text"==this.type)t.font="18px Consolas",t.fillStyle=this.color,t.fillText(this.text,this.x,this.y);else if("sprite"==this.type){var e=document.getElementById("sprites");t.save(),t.imageSmoothingEnabled=!1,t.translate(this.x,this.y),t.rotate(this.angle),this.flip&&t.scale(1,-1),t.drawImage(e,this.spriteX,this.spriteY,this.width/u,this.height/u,-this.width/2,-this.height/2,this.width,this.height),t.restore()}else"rect"==this.type&&(t.save(),t.fillStyle=o,t.translate(this.x,this.y),t.rotate(this.angle),t.fillRect(-this.width/2,-this.height/2,this.width,this.height),t.restore())},this.isClicked=function(){for(let t=0;t<T.touchPositions.length;t++){let e=T.touchPositions[t];if(this.crashWith({x:e.x,y:e.y,width:.5,height:.5}))return!0}return!1},this.crashWith=function(t){var e=this.x-this.width/2,i=this.x+this.width/2,s=this.y-this.height/2,n=this.y+this.height/2,o=t.x-t.width/2,r=t.x+t.width/2,a=t.y-t.height/2,h=t.y+t.height/2,u=!0;return(n<a||s>h||i<o||e>r)&&(u=!1),u}}function N(){for(var t=0;t<o.numRows;t++)for(var e=0;e<o.numCols;e++){var i=o.getTileCode(t,e),s=L[i];s||(s=1),new q(e*u+u/2,a+t*u+u/2,16,16,"sprite","","",9*(s-1),26,2).update()}}var b=" ",I=[" ",".","l","m","n","q","p","u","v","w"];function S(){for(var t=0;t<I.length;t++){var e=I[t],i=L[e],s=120+t*(u+8),n=u/2+6,o=new q(s,n,20,20,"rect",e===b?"#ff8888":"#dddddd");o.update(),o.isClicked()&&(b=e),new q(s,n,16,16,"sprite","","",9*(i-1),26,2).update()}}function B(){if(T.mousePosition){var t=T.mousePosition.x,e=T.mousePosition.y-a,i=Math.floor(e/u),s=Math.floor(t/u);if(i<=0||i>=o.numRows-1)return;if(s<=0||s>=o.numCols-1)return;var n=s*u+u/2,r=a+i*u+u/2,h=L[b],d=new q(n,r,20,20,"rect","#ff8888");d.update(),d.isClicked()&&o.editTileCode(i,s,b),new q(n,r,16,16,"sprite","","",9*(h-1),26,2.5).update()}}function M(){if(T.clear(),!o.isLoaded)return P.text="Loading ...",void P.update();if(r)return P.text="Edit Mode",P.update(),S(),N(),void B();T.frameNo+=1;const t=n.fromArrows(E.left||x.isClicked(),E.right||C.isClicked(),E.up||y.isClicked(),E.down||k.isClicked());n.isNone(t)?l=v:(l+=.25)>p&&(l=p);const e=s.move(c,d,g,t,l);c=e,f.reportCurrentHeadPose(c);const i=f.getSegmentPoses(5);A(m,c),P.text=o.roomName,N(),P.update();for(let s of i.slice().reverse())A(w,s),w.update();m.update(),y.update(),x.update(),C.update(),k.update()}function A(t,e){t.angle=n.toRadians(e.dir),t.flip=!n.areEqual(e.dir,n.rotateClockwise(e.normal,2));const i=n.translateEuclidean(e.pos,e.normal,t.height/2);t.x=i[0],t.y=a+o.numRows*u-i[1]}function X(t){return T.frameNo/t%1==0}window.addEventListener("load",R,!1);
},{"./room-store.js":"IzeE","./segment-train.js":"v7Zp","./tile-paths2":"+bA/","./directions":"Aw3A"}]},{},["H99C"], null)
//# sourceMappingURL=/src.be1860f1.js.map