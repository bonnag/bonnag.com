parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"IzeE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class t{constructor(){this.numCols=42,this.numRows=20,this.isLoaded=!1,this.roomName="",this.roomNumber="",this._tileCodeRows=null,this._version=0,this._getRequestInFlight=!1,this._targetRoomNumber="",this._unsavedEdits=[],this._inFlightEdits=[],window.setInterval(this._handleAmbientTick.bind(this),1e3)}_handleAmbientTick(){if(this._unsavedEdits.length>0&&0===this._inFlightEdits.length){let t=new XMLHttpRequest;t.open("PUT","https://antr.io/rooms/"+this.roomNumber);let e=this._buildEditRequest();this._inFlightEdits=this._unsavedEdits,this._unsavedEdits=[],t.setRequestHeader("Content-Type","application/json");let s=this;return t.onload=function(){204===t.status?(s._inFlightEdits=[],s._version++):(s._unsavedEdits=s._inFlightEdits.concat(s._unsavedEdits),s._inFlightEdits=[])},void t.send(JSON.stringify(e))}if(this._targetRoomNumber!==this.roomNumber&&!this._getRequestInFlight&&this.isSaved()){this.isLoaded=!1,this.roomName="Loading ...";let t=new XMLHttpRequest;t.open("GET","https://antr.io/rooms/"+this._targetRoomNumber),t.setRequestHeader("Content-Type","application/json");let e=this;return t.onload=function(){if(200===t.status){let s=JSON.parse(t.responseText);e._handleRoomResponse(s)}e._getRequestInFlight=!1},this._getRequestInFlight=!0,void t.send()}}_handleRoomResponse(t){this.roomName=t.name,this.roomNumber=t.number,this._tileCodeRows=t.tileCodeRows,this._version=t.version,this.isLoaded=!0}isSaved(){return 0===this._unsavedEdits.length&&0===this._inFlightEdits.length}changeRoom(t){let e=""+t;this._targetRoomNumber=e,this.isLoaded=!1,this.roomName="Loading ..."}getTileCode(t,e){if(!this.isLoaded)throw new Error("cannot get tiles for room that has not loaded");return this._tileCodeRows[t][e]}editTileCode(t,e,s){if(!this.isLoaded)throw new Error("cannot edit room that has not loaded");this._tileCodeRows[t]=this._replaceCharInStr(this._tileCodeRows[t],e,s),this._unsavedEdits.push({x:e,y:t,tileCode:s})}_buildEditRequest(){return{number:this.roomNumber,existingVersion:this._version,tileEdits:this._unsavedEdits.slice(),optionalNewName:null}}_replaceCharInStr(t,e,s){return t.substr(0,e)+s+t.substr(e+s.length)}}exports.default=t;
},{}],"Aw3A":[function(require,module,exports) {
const e="Z",r=["Z","N","NE","E","SE","S","SW","W","NW"];function n(e,r){return e===r}function t(e){switch(e){case"N":case"NE":case"E":case"SE":case"S":case"SW":case"W":case"NW":case"Z":return e;default:throw new Error("unsupported direction "+e)}}function c(e){return e}function u(e){return"Z"===e}function a(e){return"N"===e||"S"===e}function o(e){return"E"===e||"W"===e}function s(e){return"NE"===e||"SE"===e||"SW"===e||"NW"===e}function i(e){switch(e){case"N":return 0;case"NE":return 1;case"E":return 2;case"SE":return 3;case"S":return 4;case"SW":return 5;case"W":return 6;case"NW":return 7;default:throw new Error("unsupported direction "+e)}}function f(e){if(e<-8||e>15)throw new Error("out of range");switch(e<0?e+=8:e>=8&&(e-=8),e){case 0:return"N";case 1:return"NE";case 2:return"E";case 3:return"SE";case 4:return"S";case 5:return"SW";case 6:return"W";case 7:return"NW";default:throw new Error("unsupported ordinal "+e)}}function E(e){return(i(e)-2)/8*Math.PI*2}function d(e,r,n,t){return!e||r||n||t?e||!r||n||t?e||r||!n||t?e&&!r&&n&&!t?"NW":!e&&r&&n&&!t?"NE":e||r||n||!t?e&&!r&&!n&&t?"SW":!e&&r&&!n&&t?"SE":"Z":"S":"N":"E":"W"}function w(e,r){if(e===r)return!0;if(u(e)||u(r))return!1;const n=i(e),t=i(r);return(n+1)%8==t||(t+1)%8==n}function h(r,n){return w(r,n)?{effect:1,dir:n}:w(l(r),n)?{effect:-1,dir:l(n)}:{effect:0,dir:e}}function l(e){return N(e,4)}function N(e,r){if(r<-8||r>8)throw new Error("out of range");return u(e)?e:f(i(e)+r)}function S(e){return u(e)?[e]:[e,N(e,-1),N(e,1)]}function W(e,r){return Math.max(Math.abs(e[0]-r[0]),Math.abs(e[1]-r[1]))}function b(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function p(e,n){const t=W(e,n);let c=void 0,u=void 0;for(let a of r){let r=W(M(e,a,t),n);(!u||r<c)&&(c=r,u=a)}return u}function M(e,r,n){switch(r){case"Z":return[e[0],e[1]];case"N":return[e[0],e[1]+n];case"NE":return[e[0]+n,e[1]+n];case"E":return[e[0]+n,e[1]];case"SE":return[e[0]+n,e[1]-n];case"S":return[e[0],e[1]-n];case"SW":return[e[0]-n,e[1]-n];case"W":return[e[0]-n,e[1]];case"NW":return[e[0]-n,e[1]+n];default:throw new Error("unsupported direction "+r)}}function Z(e,r,n){return M(e,r,s(r)?n*Math.sqrt(2)*.5:n)}function k(e,r,n,t){if(t<0)throw new Error("tolerance out of range");return W(n,C(e,r,n))<t}function v(e,r){return[e[0]+r[0],e[1]+r[1]]}function g(e,r){return[e[0]-r[0],e[1]-r[1]]}function m(e,r){return[e[0]*r,e[1]*r]}function C(e,r,n){const t=g(n,e);let c=void 0;switch(r){case"Z":c=[0,0];break;case"N":case"S":c=[0,t[1]];break;case"E":case"W":c=[t[0],0];break;case"NE":case"SW":{const e=.5*(t[0]+t[1]);c=[e,e];break}case"NW":case"SE":{const e=.5*(t[0]-t[1]);c=[e,-e];break}default:throw new Error("bad direction "+dir)}return v(c,e)}module.exports={None:e,All:r,areEqual:n,fromCardinal:t,fromArrows:d,toCardinal:c,toRadians:E,isNone:u,isVertical:a,isHorizontal:o,isDiagonal:s,actsOn:h,reverse:l,rotateClockwise:N,andEitherSide:S,translateChebyshev:M,translateEuclidean:Z,chebyshevDistanceBetween:W,euclideanDistanceBetween:b,bestDirBetween:p,snapToLine:C,isOnLine:k,addVec:v,subVec:g,scaleVec:m};
},{}],"+bA/":[function(require,module,exports) {
function e(e,r){return n(e)||i(e,r)||t()}function t(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function i(e,t){var i=[],n=!0,r=!1,o=void 0;try{for(var s,l=e[Symbol.iterator]();!(n=(s=l.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(a){r=!0,o=a}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}return i}function n(e){if(Array.isArray(e))return e}const r=require("./directions"),o=1e-8;function s(e,t){const i=e.tileSize,n=[Math.floor(t[0]/i),Math.floor(t[1]/i)];return[n,[t[0]-n[0]*i,t[1]-n[1]*i],r.scaleVec(n,i)]}function l(e,t,i,n,o){const s=u(e,t,i,n,o),l=r.translateChebyshev(e.pos,n,o);let a=void 0,c=void 0;for(let u of s.concat([e])){let e=r.chebyshevDistanceBetween(u.pos,l);(!c||e<a)&&(a=e,c=u)}return c}function a(e,t){const i=e.tileSize,n=e.minDist,o=i-n;let s=[];return"v"===t?s=[{tileRelativeLinePos:[0,o],startToEndDir:r.fromCardinal("E")}]:"q"===t?s=[{tileRelativeLinePos:[o,i],startToEndDir:r.fromCardinal("S")}]:"m"===t?s=[{tileRelativeLinePos:[i,n],startToEndDir:r.fromCardinal("W")}]:"p"===t?s=[{tileRelativeLinePos:[n,0],startToEndDir:r.fromCardinal("N")}]:"w"===t?s=[{tileRelativeLinePos:[0,0],startToEndDir:r.fromCardinal("NE")}]:"u"===t?s=[{tileRelativeLinePos:[0,i],startToEndDir:r.fromCardinal("SE")}]:"l"===t?s=[{tileRelativeLinePos:[i,i],startToEndDir:r.fromCardinal("SW")}]:"n"===t&&(s=[{tileRelativeLinePos:[i,0],startToEndDir:r.fromCardinal("NW")}]),s}function u(t,i,n,r,o){const l=e(s(i,t.pos),3);return f(c(t,i,n,l[0],l[1],l[2],r,o,0))}function c(e,t,i,n,s,l,u,f,h){if(f<-o)throw new Error("motionDistance cannot be negative");if(f<t.minDist)return[];if(r.isNone(u))return[];const E=a(t,i.tileCodeAt(n));if(E.length<1)return[];if(E.length>1)throw new Error("multiple paths in one tile not supported");const p=E[0],y=2*t.minDist+o,C=D(t,p,s,0==h?o:y);if(!C)return[];const P=r.chebyshevDistanceBetween(s,C);if(P>f)return[];let w=f-P;const T=[],b=r.andEitherSide(u);for(let a of b){let s=v(t,p,C,a,w);s||(s={tileRelativePos:C,dir:e.dir,normal:r.rotateClockwise(p.startToEndDir,-2)});let f=w-r.chebyshevDistanceBetween(C,s.tileRelativePos);if(f<t.minDist+o){T.push(d(s,l));continue}let D=!1;if(0==h)for(let r of m(t,n,s.tileRelativePos)){let n=c(e,t,i,r.tileCoords,r.dubiousTileRelativePos,r.tileOriginPos,u,f,h+1);n.length>0&&(D=!0,T.push(...n))}D||T.push(d(s,l))}return T}function f(e){const t=new Set,i=[];for(let n of e){let e=JSON.stringify(n);t.has(e)||(t.add(e),i.push(n))}return i}function d(e,t){return{pos:h(t,e.tileRelativePos),dir:e.dir,normal:e.normal}}function h(e,t){return[e[0]+t[0],e[1]+t[1]]}function v(e,t,i,n,s){if(s<-o)throw new Error("motionDistance cannot be negative");if(s<e.minDist)return;if(r.isNone(n))return;const l=r.actsOn(n,t.startToEndDir);if(0==l.effect)return;const a=r.translateChebyshev(i,l.dir,s),u=E(e,a);return{tileRelativePos:r.translateChebyshev(a,l.dir,-u),dir:l.dir,normal:r.rotateClockwise(t.startToEndDir,-2)}}function*m(e,t,i){for(let n of r.All){if(r.isNone(n))continue;let o=r.translateChebyshev([0,0],n,1),s=r.translateChebyshev([0,0],n,-e.tileSize),l=r.addVec(t,o),a=r.addVec(i,s);yield{tileCoords:l,dubiousTileRelativePos:a,tileOriginPos:r.scaleVec(l,e.tileSize)}}}function D(e,t,i,n){const o=r.snapToLine(t.tileRelativeLinePos,t.startToEndDir,i),s=E(e,o),l=[.5*e.tileSize,.5*e.tileSize],a=r.bestDirBetween(o,l),u=r.translateChebyshev(o,a,s),c=r.snapToLine(t.tileRelativeLinePos,t.startToEndDir,u);return r.chebyshevDistanceBetween(i,c)<n?c:void 0}function E(e,t){return Math.max(p(e,t[0]),p(e,t[1]))}function p(e,t){const i=e.tileSize-e.minDist;return t<0?0-t:t>i?t-i:0}module.exports={quantize:s,move:l,computeMoves:u};
},{"./directions":"Aw3A"}],"H99C":[function(require,module,exports) {
"use strict";var t=e(require("./room-store.js"));function e(t){return t&&t.__esModule?t:{default:t}}const i=require("./tile-paths2"),s=require("./directions"),n=new t.default;let o=!1;const r=28,h=28,a=16,u={tileSize:a,minDist:.01};let d={pos:[160,96-u.minDist],dir:s.fromCardinal("E"),normal:s.fromCardinal("N")},c=0;const l=1,f=2.5,v={tileCodeAt:function(t){const e=t[0],i=n.numRows-t[1]-1;return n.getTileCode(i,e)}};let p=void 0,g=void 0,m=void 0,w=void 0,y=void 0,P=void 0;const x={},C={k37:"left",k39:"right",k38:"up",k40:"down"},k={" ":1,".":2,l:9,m:5,n:10,q:4,p:6,u:8,v:3,w:7};function E(){n.changeRoom(5050),window.addEventListener("keydown",function(t){D.keys=D.keys||[];var e=["k"+t.keyCode],i=C[e];i&&(x[i]=!0,t.preventDefault())}),window.addEventListener("keyup",function(t){if(69===t.keyCode)return o=!o,void t.preventDefault();var e=C["k"+t.keyCode];e&&(x[e]=!1,t.preventDefault())}),p=new L(160,257,16,16,"sprite","","",0,16,2),g=new L(16,14,0,0,"text","black",""),m=new L(60,240,42,42,"sprite","","",52,0,2),w=new L(25,275,42,44,"sprite","","",10,0,2),y=new L(95,275,42,44,"sprite","","",31,0,2),P=new L(60,310,42,42,"sprite","","",74,0,2),D.start()}const D={canvas:document.createElement("canvas"),touchPositions:[],mousePosition:null,start:function(){this.canvas.width=n.numCols*a,this.canvas.height=r+n.numRows*a+28,this.context=this.canvas.getContext("2d"),document.body.insertBefore(this.canvas,document.getElementById("gameAreaHolder")),this.frameNo=0,this.interval=setInterval(b,20);let t=this;this.canvas.addEventListener("mousedown",function(e){t.touchPositions=[t.getPointerPos(e)],e.preventDefault()},!1),this.canvas.addEventListener("mouseup",function(e){t.touchPositions=[],e.preventDefault()},!1),this.canvas.addEventListener("mousemove",function(e){var i=t.getPointerPos(e);t.mousePosition=i,e.buttons>0&&(t.touchPositions=[i]),e.preventDefault()},!1),this.canvas.addEventListener("touchstart",function(e){t.touchPositions=[];for(var i=0;i<e.targetTouches.length;i++)t.touchPositions.push(t.getPointerPos(e.targetTouches[i]));e.preventDefault()},!1),this.canvas.addEventListener("touchend",function(e){t.touchPositions=[];for(var i=0;i<e.targetTouches.length;i++)t.touchPositions.push(t.getPointerPos(e.targetTouches[i]));e.preventDefault()},!1),this.canvas.addEventListener("touchmove",function(e){t.touchPositions=[];for(var i=0;i<e.targetTouches.length;i++)t.touchPositions.push(t.getPointerPos(e.targetTouches[i]));e.preventDefault()},!1)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},stop:function(){clearInterval(this.interval)},getPointerPos:function(t){const e=this.canvas.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}};function L(t,e,i,s,n,o,r,h,a,u){this.body=null,this.x=t,this.y=e,this.angle=0,this.flip=!1,this.width=i,this.height=s,this.type=n,this.text=r,this.color=o,this.spriteX=h,this.spriteY=a,this.update=function(){const t=D.context;if("text"==this.type)t.font="18px Consolas",t.fillStyle=this.color,t.fillText(this.text,this.x,this.y);else if("sprite"==this.type){var e=document.getElementById("sprites");t.save(),t.imageSmoothingEnabled=!1,t.translate(this.x,this.y),t.rotate(this.angle),this.flip&&t.scale(1,-1),t.drawImage(e,this.spriteX,this.spriteY,this.width/u,this.height/u,-this.width/2,-this.height/2,this.width,this.height),t.restore()}else"rect"==this.type&&(t.save(),t.fillStyle=o,t.translate(this.x,this.y),t.rotate(this.angle),t.fillRect(-this.width/2,-this.height/2,this.width,this.height),t.restore())},this.isClicked=function(){for(let t=0;t<D.touchPositions.length;t++){let e=D.touchPositions[t];if(this.crashWith({x:e.x,y:e.y,width:.5,height:.5}))return!0}return!1},this.crashWith=function(t){var e=this.x-this.width/2,i=this.x+this.width/2,s=this.y-this.height/2,n=this.y+this.height/2,o=t.x-t.width/2,r=t.x+t.width/2,h=t.y-t.height/2,a=t.y+t.height/2,u=!0;return(n<h||s>a||i<o||e>r)&&(u=!1),u}}function R(){for(var t=0;t<n.numRows;t++)for(var e=0;e<n.numCols;e++){var i=n.getTileCode(t,e),s=k[i];s||(s=1),new L(e*a+a/2,r+t*a+a/2,16,16,"sprite","","",9*(s-1),26,2).update()}}var T=" ",q=[" ",".","l","m","n","q","p","u","v","w"];function I(){for(var t=0;t<q.length;t++){var e=q[t],i=k[e],s=120+t*(a+8),n=a/2+6,o=new L(s,n,20,20,"rect",e===T?"#ff8888":"#dddddd");o.update(),o.isClicked()&&(T=e),new L(s,n,16,16,"sprite","","",9*(i-1),26,2).update()}}function N(){if(D.mousePosition){var t=D.mousePosition.x,e=D.mousePosition.y-r,i=Math.floor(e/a),s=Math.floor(t/a);if(i<=0||i>=n.numRows-1)return;if(s<=0||s>=n.numCols-1)return;var o=s*a+a/2,h=r+i*a+a/2,u=k[T],d=new L(o,h,20,20,"rect","#ff8888");d.update(),d.isClicked()&&n.editTileCode(i,s,T),new L(o,h,16,16,"sprite","","",9*(u-1),26,2.5).update()}}function b(){if(D.clear(),!n.isLoaded)return g.text="Loading ...",void g.update();if(o)return g.text="Edit Mode",g.update(),I(),R(),void N();D.frameNo+=1;const t=s.fromArrows(x.left||w.isClicked(),x.right||y.isClicked(),x.up||m.isClicked(),x.down||P.isClicked());s.isNone(t)?c=l:(c+=.25)>f&&(c=f);const e=i.move(d,u,v,t,c);d=e,p.angle=s.toRadians(d.dir),p.flip=!s.areEqual(d.dir,s.rotateClockwise(d.normal,2)),console.log(p.flip,p.angle/Math.PI*180);const h=s.translateEuclidean(d.pos,d.normal,p.height/2);p.x=h[0],p.y=r+n.numRows*a-h[1],g.text=n.roomName,R(),g.update(),p.update(),m.update(),w.update(),y.update(),P.update()}function M(t){return D.frameNo/t%1==0}window.addEventListener("load",E,!1);
},{"./room-store.js":"IzeE","./tile-paths2":"+bA/","./directions":"Aw3A"}]},{},["H99C"], null)
//# sourceMappingURL=/src.96322081.js.map